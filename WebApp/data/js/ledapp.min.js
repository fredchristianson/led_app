'use strict';const API_BASE_DINING_ROOM$$module$="http://192.168.10.130/api/",API_BASE_LIVING_ROOM$$module$="http://192.168.10.120/api/",API_BASE_SAME_HOST$$module$="/api/",API_BASE$$module$=API_BASE_DINING_ROOM$$module$;
class Api$$module${constructor(){this.baseUrl=API_BASE_DINING_ROOM$$module$}async get(a){return new Promise((b,c)=>{const d=new XMLHttpRequest;d.onload=e=>{b(d.responseText)};d.onerror=e=>{c(d.response)};d.open("GET",this.baseUrl+a);d.send()})}async getJSON(a,b){a=await this.get(a,b);return JSON.parse(a)}async post(a,b){return new Promise((c,d)=>{const e=new XMLHttpRequest;e.open("POST",this.baseUrl+a,!0);e.onreadystatechange=()=>{e.readyState==XMLHttpRequest.DONE&&c(e.resonseText)};e.onerror=f=>
{d(e.response)};e.setRequestHeader("Content-Type","application/json");e.send(b);return!0})}}const LOG_LEVEL$$module$={Dom:{debug:!1},LedSelector:{debug:!1},ColorSlider:{debug:!1}};
class Logger$$module${constructor(a){this.moduleName=a;this.debugElement=document.getElementById("debug-messages")}enabled(a){const b=LOG_LEVEL$$module$[this.moduleName];return b&&!1===b[a]?!1:!0}write(a,b="unknown"){console.log(this.moduleName+"("+b+"): "+a);b=document.createElement("pre");b.innerHTML=a;this.debugElement&&this.debugElement.appendChild(b)}debug(a){this.enabled("debug")&&this.write(a,"debug")}warn(a){this.enabled("warn")&&this.write(a,"warn")}error(a,b=null){this.enabled("error")&&
(this.write(a,"error"),b&&(this.write(b),b.stack&&this.write(b.stack)))}}class Observable$$module${constructor(){this.observers=[]}observe(a){this.observers.push(a)}changed(){this.observers.forEach(a=>{a(this)})}}
class Gradient$$module${constructor(a,b){this.startValue=a;this.endValue=b}setValue(a){throw new Exception("setValue() not implemented");}apply(a,b,c){if(!(null==b||0>b||null==c||0>c)){var d=a.length;b=Math.floor(b*d/100);c=Math.floor(c*d/100);for(var e=this.endValue-this.startValue+1,f=b;f<a.length&&f<=c;f++)this.setValue(a[f],this.startValue+(f-b)/d*e)}}}
class HueGradient$$module$ extends Gradient$$module${constructor(a,b){super(a,b)}setValue(a,b){a.hue=colorMgr$$module$.hueRangeValueToHtmlHue(b)}}class SaturationGradient$$module$ extends Gradient$$module${constructor(a,b){super(a,b)}setValue(a,b){a.saturation=b}}class LevelGradient$$module$ extends Gradient$$module${constructor(a,b){super(a,b)}setValue(a,b){a.level=b}}
class HslColor$$module$ extends Observable$$module${constructor(a){super();this.colorMgr=a;this.htmlHue=this.hueRangeValue=0;this.saturation=100;this.level=50;this.ledPercent=null}setLedPercent(a){this.ledPercent=a}getLedPercent(){return this.ledPercent}setHueRangeValue(a){this.hueRangeValue=a;this.htmlHue=this.colorMgr.hueRangeValueToHtmlHue(a);this.changed();this.colorMgr.changed()}setSaturation(a){this.saturation=a;this.changed();this.colorMgr.changed()}setLevel(a){this.level=a;this.changed();
this.colorMgr.changed()}getHueRangeValue(){return this.hueRangeValue}getHtmlHue(){return this.htmlHue}getSaturation(){return this.saturation}getLevel(){return this.level}getHsl(){return this.htmlColor=`hsl(${this.htmlHue},${this.colorMgr.saturationEnabled?this.saturation:100}%,${this.colorMgr.levelEnabled?this.level:50}%)`}}
class ColorManager$$module$ extends Observable$$module${constructor(){super();this.first=new HslColor$$module$(this);this.last=new HslColor$$module$(this);this.image=DOM$$module$.first("#image-spectrum");this.hueMap={};this.levelEnabled=this.saturationEnabled=this.hueEnabled=!0;this.gradientEnabled=!1}enableGradient(a=!0){this.gradientEnabled=a;this.changed()}disableHue(){this.hueEnabled=!1;this.changed()}enableHue(a=!0){this.hueEnabled=a;this.changed()}disableSaturation(){this.saturationEnabled=
!1;this.changed()}enableSaturation(a=!0){this.saturationEnabled=a;this.changed()}disableLevel(){this.levelEnabled=!1;this.changed()}enableLevel(a=!0){this.levelEnabled=a;this.changed()}setSelectedRange(a,b){this.first.setLedPercent(a);this.last.setLedPercent(b);this.changed()}hueRangeValueToHtmlHue(a){if(this.hueMap[a])return this.hueMap[a];var b=DOM$$module$.getPixel(this.image,this.image.naturalWidth*a/this.image.offsetWidth,50);b=rgb2hsv$$module$(b[0],b[1],b[2]).hue;return this.hueMap[a]=b}getStartHslColor(){return this.first}getEndHslColor(){return this.gradientEnabled?
this.last:this.first}updateColors(a){const b=this.gradientEnabled;var c=this.first;const d=b?this.last:this.first,e=new HueGradient$$module$(c.getHueRangeValue(),d.getHueRangeValue()),f=new LevelGradient$$module$(c.getLevel(),d.getLevel()),h=new SaturationGradient$$module$(c.getSaturation(),d.getSaturation());this.hueEnabled&&e.apply(a,c.getLedPercent(),this.last.getLedPercent());this.levelEnabled&&f.apply(a,c.getLedPercent(),this.last.getLedPercent());this.saturationEnabled&&h.apply(a,c.getLedPercent(),
this.last.getLedPercent());a.forEach(g=>{g.htmlColor=null!=g.hue?`hsl(${g.hue},${null===g.saturation?100:g.saturation}%,${null===g.level?50:g.level}%)`:"hsl(0,0%,0%)"});a=c.getHueRangeValue();b&&(a=a+" - "+d.getHueRangeValue());DOM$$module$.setHtml(".hue-value",a);a=c.getSaturation();b&&(a=a+" - "+d.getSaturation());DOM$$module$.setHtml(".saturation-value",a);c=c.getLevel();b&&(c=c+" - "+d.getLevel());DOM$$module$.setHtml(".lightness-value",c)}}
class ColorSlider$$module${constructor(a,b,c,d){this.control=a;this.image=a.image;this.selector=c;this.hslColor=d;d.observe(this.onColorChanged.bind(this));colorMgr$$module$.observe(this.onColorChanged.bind(this));this.container=DOM$$module$.first(b);this.element=DOM$$module$.first(b,this.selector);this.moveable=this.element.parentNode;DOM$$module$.onTouch(this,b,c);this.logger=new Logger$$module$("ColorSlider");this.htmlHue=this.hueRangeOffset=this.hueRangeValue=0;this.hslColor.setHueRangeValue(this.hueRangeValue)}touchStart(a,
b){this.logger.debug("start touch "+a.moveTarget.id)}touchMove(a,b){try{this.logger.debug(`move touch ${a.moveTarget.id} ${a.moveTarget.className} ${a.currentPos.x},${a.lastMovement.dx}`);var c=a.moveTarget,d=a.currentPos.x;if(!isNaN(d)){for(;null!=c&&c!=this.container;){d+=c.offsetLeft;if(isNaN(d))return;c=c.parentNode}d=Math.max(d,0);d=Math.min(d,this.image.naturalWidth-1);this.moveable.style.left=`${d}px`;this.hueRangeOffset=d;this.hueRangeValue=Math.round(d*this.image.offsetWidth/this.image.naturalWidth);
this.hslColor.setHueRangeValue(this.hueRangeValue)}}catch(e){this.logger.error("move failed ",e)}}touchEnd(a,b){this.logger.debug("end touch "+a.moveTarget.id)}onColorChanged(a){this.element.style.backgroundColor=this.hslColor.getHsl()}}
class HueSelector$$module${constructor(a){this.hueMap={};this.logger=new Logger$$module$("HueSelector");this.section=document.querySelector("section.hsv");this.image=DOM$$module$.first(".hsv .hue img");this.selected=DOM$$module$.first(this.section,".selected");this.colorElement=DOM$$module$.first(this.section,".color");this.firstSlider=new ColorSlider$$module$(this,".hsv .hue .select",".first .color",colorMgr$$module$.first);this.lastSlider=new ColorSlider$$module$(this,".hsv .hue .select",".last .color",
colorMgr$$module$.last);this.selectedSlider=null}getHueRangeValue(){return 0}getHtmlHue(){return 0}toHex2(a){a=a.toString(16);return 1==a.length?"0"+a:a}}
class LedSelector$$module${constructor(a){this.count=101;this.logger=new Logger$$module$("LedSelector");this.section=document.querySelector(".preview");this.container=document.getElementById("preview-leds");this.selFirst=this.section.querySelector("h2 .first");this.selLast=this.section.querySelector("h2 .last");this.selCurrent=this.section.querySelector("h2 .current");this.app=a;this.selectedEndIndex=this.selectedStartIndex=null;this.createLeds(this.count);DOM$$module$.html(this.selFirst,"--");DOM$$module$.html(this.selCurrent,
"--");DOM$$module$.html(this.selLast,"--");DOM$$module$.onTouch(this,"#preview-leds",".led");DOM$$module$.onClick(".select-all",this.selectAll.bind(this));DOM$$module$.onClick(".select-clear",this.selectClear.bind(this))}getStartLed(){return this.selectedStartIndex}getEndLed(){return this.selectedEndIndex}getStartLedPercent(){return this.ledElements[this.selectedStartIndex].dataset.percent}getEndLedPercent(){return this.ledElements[this.selectedEndIndex].dataset.percent}selectAll(){this.selectedStartIndex=
0;this.selectedEndIndex=this.ledElements.length-1;this.showSelectedLeds()}isAllSelected(){return 0==this.selectedStartIndex&&this.selectedEndIndex==this.ledElements.length-1}selectClear(){this.selectedEndIndex=this.selectedStartIndex=null;this.showSelectedLeds()}touchStart(a,b){(a=a.moveTarget)&&a.dataset&&a.dataset.index?(a=1*a.dataset.index,this.logger.debug("touch start "+a),this.selFirst.innerHTML=""+a,this.selectedStartIndex=a,this.selLast.innerHTML="--"):this.selectedStartIndex=null}touchEnd(a,
b){this.logger.debug("touch end ");this.showSelectedLeds()}touchMove(a,b){a=a.moveTarget;this.logger.debug("touchmove "+a.id+" "+a.className);a&&a.dataset&&a.dataset.index&&(a=1*a.dataset.index,this.logger.debug("touch move "+a),null==this.selectedStartIndex?(this.selFirst.innerHTML=""+a,this.selectedStartIndex=a):(this.selLast.innerHTML=""+a,this.selectedEndIndex=a),this.selLast.innerHTML="--",this.showSelectedLeds())}showSelectedLeds(){if(null==this.selectedStartIndex||null==this.selectedEndIndex)colorMgr$$module$.setSelectedRange(null,
null),DOM$$module$.removeClass("#preview-leds .led","selected");else{var a=Math.min(this.selectedStartIndex,this.selectedEndIndex),b=Math.max(this.selectedStartIndex,this.selectedEndIndex);this.selFirst.innerHTML=""+a;this.selLast.innerHTML=""+b;var c=DOM$$module$.find("#preview-leds .led");c.forEach(d=>{d.dataset.index>=a&&d.dataset.index<=b?(this.logger.debug("selected "+d.dataset.index),DOM$$module$.addClass(d,"selected")):(this.logger.debug("unselected "+d.dataset.index),DOM$$module$.removeClass(d,
"selected"))});colorMgr$$module$.setSelectedRange(c[a].dataset.percent,c[b].dataset.percent)}}setColors(a){DOM$$module$.find("#preview-leds .led").forEach(b=>{var c=a[b.dataset.index];b.style.backgroundColor=null!=c?c.htmlColor:"#000000"})}setCount(a){this.logger.warn("cannot set led count any more.  always use 101 for 0-100%")}getCount(){return this.count}createLeds(a){var b=this.container.querySelectorAll(".led");b.forEach(d=>{d.dataset.index>this.count&&this.container.removeChild(d)});for(var c=
b.length;c<a;c++)b=document.createElement("span"),b.className="led",b.dataset.index=c,b.style.backgroundColor="#000000",b.dataset.color="#000000",this.container.appendChild(b);b=DOM$$module$.find("#preview-leds .led");a=b.length;for(c=0;c<a;c++)b[c].dataset.percent=Math.round(c/(a-1)*100);this.ledElements=b}}
class InputRangeSelector$$module${constructor(a){this.elem=DOM$$module$.first(a);DOM$$module$.onInput(this.elem,this.onChange.bind(this));DOM$$module$.onChange(this.elem,this.onSelected.bind(this))}changed(a){alert("changed(value) not implemented")}onChange(a,b){this.changed(DOM$$module$.getValue(a))}onSelected(a,b){this.changed(DOM$$module$.getValue(a))}}
class SaturationSelector$$module$ extends InputRangeSelector$$module${constructor(a,b){super(a);this.hslColor=b}changed(a){this.hslColor.setSaturation(a)}}class LevelSelector$$module$ extends InputRangeSelector$$module${constructor(a,b){super(a);this.hslColor=b}changed(a){this.hslColor.setLevel(a)}}
class LedApp$$module${constructor(){this.logger=new Logger$$module$("LedApp");this.logger.debug("LedApp running");this.ledSelector=new LedSelector$$module$(this);this.hueSelector=new HueSelector$$module$(this);this.xhrOpen=!1;DOM$$module$.onClick(".run-commands",this.runCommands.bind(this));this.zoom=1;DOM$$module$.onClick("#gradient",this.toggleGradient.bind(this));DOM$$module$.onClick("#hue-off",this.toggleHue.bind(this));DOM$$module$.onClick("#level-off",this.toggleLevel.bind(this));DOM$$module$.onClick("#saturation-off",
this.toggleSaturation.bind(this));this.saturationFirst=new SaturationSelector$$module$("#saturation-first",colorMgr$$module$.first);this.saturationLast=new SaturationSelector$$module$("#saturation-last",colorMgr$$module$.last);this.levelFirst=new LevelSelector$$module$("#level-first",colorMgr$$module$.first);this.levelLast=new LevelSelector$$module$("#level-last",colorMgr$$module$.last);colorMgr$$module$.observe(this.onColorChanged.bind(this));DOM$$module$.onClick(".create-command.hue",this.createHueCommand.bind(this));
DOM$$module$.onClick(".create-command.level",this.createLevelCommand.bind(this));DOM$$module$.onClick(".create-command.saturation",this.createSaturationCommand.bind(this));DOM$$module$.onClick(".create-command.add-hsl",this.createHSLCommands.bind(this));this.debouceTimeout=null;this.initialize()}autoGenerateCommands(){DOM$$module$.setValue("#scene-name","auto");this.createHSLCommands();this.saveCommands()}onColorChanged(){this.ledSelector.isAllSelected()&&DOM$$module$.isChecked("#auto-create")&&(null!=
this.debouceTimeout&&clearTimeout(this.debouceTimeout),this.debouceTimeout=setTimeout(this.autoGenerateCommands.bind(this),500));this.runCommands()}isGradient(){return DOM$$module$.first("#gradient").checked}toggleHue(a,b){a.checked?(DOM$$module$.addClass(document.body,"no-hue"),colorMgr$$module$.disableHue()):(colorMgr$$module$.enableHue(),DOM$$module$.removeClass(document.body,"no-hue"));colorMgr$$module$.changed();return!1}toggleSaturation(a,b){DOM$$module$.toggleClass(document.body,"no-saturation");
colorMgr$$module$.enableSaturation(!a.checked);return!1}toggleLevel(a,b){DOM$$module$.toggleClass(document.body,"no-level",a.checked);colorMgr$$module$.enableLevel(!a.checked);return!1}toggleGradient(a,b){DOM$$module$.toggleClass(document.body,"gradient",a.checked);colorMgr$$module$.enableGradient(a.checked);return!1}createHueCommand(){const a=colorMgr$$module$.getStartHslColor(),b=colorMgr$$module$.getEndHslColor();this.addCommand("h",this.ledSelector.getStartLedPercent(),this.ledSelector.getEndLedPercent(),
a.getHueRangeValue(),b.getHueRangeValue())}createLevelCommand(){const a=colorMgr$$module$.getStartHslColor(),b=colorMgr$$module$.getEndHslColor();this.addCommand("l",this.ledSelector.getStartLedPercent(),this.ledSelector.getEndLedPercent(),a.getLevel(),b.getLevel())}createSaturationCommand(){const a=colorMgr$$module$.getStartHslColor(),b=colorMgr$$module$.getEndHslColor();this.addCommand("s",this.ledSelector.getStartLedPercent(),this.ledSelector.getEndLedPercent(),a.getSaturation(),b.getSaturation())}createHSLCommands(){DOM$$module$.setValue("#scene",
"");colorMgr$$module$.hueEnabled&&this.createHueCommand();colorMgr$$module$.levelEnabled&&this.createLevelCommand();colorMgr$$module$.saturationEnabled&&this.createSaturationCommand()}addCommand(a,b,c,d,e){if(null==b||null==c||isNaN(b)||isNaN(c))this.logger.error("invalid range "+b+" "+c);else{var f=DOM$$module$.first("#gradient-reverse").checked,h=DOM$$module$.getValue('input[name="gradient-type"]:checked'),g=DOM$$module$.getValue('input[name="led-position"]:checked'),l=DOM$$module$.getValue("#animate-speed");
a=`${a},${b},${c},${d},${e},${1},${l},${f?"R":"F"}${h}${g};\n`;b=DOM$$module$.getValue("#scene");DOM$$module$.setValue("#scene",b+a);this.runCommands()}}runCommands(){const a=[];for(var b=0;b<this.ledSelector.getCount();b++)a[b]={hue:null,level:null,saturation:null,htmlColor:null};DOM$$module$.getValue("#scene").split(";").forEach(c=>{c=c.trim().split(",");for(var d=1;d<c.length;d++){var e=Number.parseFloat(c[d]);isNaN(e)||(c[d]=e)}if(1<c.length){e=c[0];const f=c[1],h=c[2];d=null;"h"==e?d=new HueGradient$$module$(c[3],
c[4]):"l"==e?d=new LevelGradient$$module$(c[3],c[4]):"s"==e&&(d=new SaturationGradient$$module$(c[3],c[4]));d?d.apply(a,f,h):this.logger.debug("unknownn command: "+e)}});colorMgr$$module$.updateColors(a);this.ledSelector.setColors(a)}updateColor(){}hueChanged(){this.htmlHue=this.hueSelector.getHtmlHue();this.hueRangeValue=this.hueSelector.getHueRangeValue();const a=this.ledSelector.getStartLed(),b=this.ledSelector.getEndLed();this.addCommand("h",a,b,this.hueRangeValue,this.hueRangeValue,this.zoom);
this.updateColor()}d2h(a){a=a.toString(16);return 1==a.length?"0"+a:a}toHexColor(a){return`#${this.d2h(a.r)}${this.d2h(a.g)}${this.d2h(a.b)}`}async initialize(){DOM$$module$.onClick("#save-scene",this.saveCommands.bind(this));DOM$$module$.onClick("#load-scene",this.loadCommands.bind(this));this.api=new Api$$module$;await this.readConfig();this.ledSelector.selectAll()}async readConfig(){const a=await this.api.getJSON("scene/config");a?(this.config=a,this.ledSelector.setCount(this.config.led_count),
DOM$$module$.setHtml("#room-name",this.config.hostname+" - "+this.config.ip_addr),DOM$$module$.setSelectOptions("#saved-scenes",this.config.scenes,null),this.ledSelector.selectClear(),this.runCommands()):alert("Failed to get configuration")}async loadCommands(){const a=DOM$$module$.getValue("#saved-scenes");try{const b=await this.api.get(`scene/${a}`);DOM$$module$.setValue("#scene",b);DOM$$module$.setValue("#scene-name",a);this.ledSelector.selectClear();this.runCommands()}catch(b){this.logger.error("load failed ",
b)}}async saveCommands(){const a=DOM$$module$.getValue("#scene-name"),b=DOM$$module$.getValue("#scene");DOM$$module$.setValue("#saved-scenes",a);try{await this.api.post(`scene/${a}`,b)}catch(c){this.logger.error("POST failed",c),alert("save failed")}}}
function rgb2hsv$$module$(a,b,c){let d,e;let f,h,g,l,p;a/=255;b/=255;c/=255;g=Math.max(a,b,c);l=g-Math.min(a,b,c);var m=k=>(g-k)/6/l+.5;p=k=>Math.round(100*k)/100;0==l?f=h=0:(h=l/g,d=m(a),e=m(b),m=m(c),a===g?f=m-e:b===g?f=1/3+d-m:c===g&&(f=2/3+e-d),0>f?f+=1:1<f&&--f);return{hue:Math.round(360*f),saturation:p(100*h),value:p(100*g)}}
class Dom$$module${constructor(a=null){this.root=(this.rootSelector=a)?document.querySelector(a):document;this.listeners=[];this.logger=new Logger$$module$("Dom");Dom$$module$.NULL_ELEMENT=document.createElement("div")}removeClass(a,b){this.find(a).forEach(c=>{c.classList.remove(b)})}addClass(a,b){this.find(a).forEach(c=>{c.classList.add(b)})}toggleClass(a,b,c=null){a=this.find(a);a.forEach(d=>{var e=c;null===c&&(e=!this.hasClass(d,b));e?d.classList.add(b):d.classList.remove(b)})}getParentAndSelector(a){var b=
document,c="*";1==a.length?c=a[0]:2==a.length?(b=this.first(a[0]),c=a[1]):alert("invalid options passed.  expect (selector) or (parent,selector)");Array.isArray(b)&&(b=b.filter(d=>{(d=d instanceof HTMLElement||d instanceof HTMLDocument)||this.logger.warn("parent array contains item that cannot be an HTMLElement parent");return d}));return{parent:b,selector:c}}first(...a){a=this.getParentAndSelector(a);try{var b=null;if(a.selector instanceof HTMLElement)b=a.selector;else if(Array.isArray(a.parent)){b=
null;for(var c=0;null==b&&c<a.parent.length;c++)b=a.parent[c].querySelector(a.selector)}else b=a.parent.querySelector(a.selector);return b}catch(d){return this.logger.error("failed to find first child of selector ",a.selector,d),null}}find(...a){const b=this.getParentAndSelector(a);if(b.selector instanceof HTMLElement)return[b.selector];if(Array.isArray(b.parent))return a=b.parent.map(c=>Array.from(c.querySelectorAll(b.selector))),[].concat(...a);a=b.parent.querySelectorAll(b.selector);return Array.from(a)}hasClass(a,
b){return a&&a.classList&&a.classList.contains(b)}html(a,b=null){if(b)this.find(a).forEach(c=>{c.innerHTML=b});else return this.first(a).innerHTML}onHover(a,b,c=null){null==c&&(c=b);var d=null,e=a,f=a;"function"!=typeof a&&(d=a,e=d.hoverStart.bind(d),f=d.hoverEnd.bind(d));this.listen("mouseover",b,h=>{const g=h.target;this.match(g,c)&&e(g,h)});this.listen("mouseout",b,h=>{const g=h.target;this.match(g,c)&&f(g,h)})}onTouch(a,b,c=null){b=this.first(b);var d=null,e=a,f=a,h=a;"function"!=typeof a&&(d=
a,e=d.touchStart?d.touchStart.bind(d):null,f=d.touchEnd?d.touchEnd.bind(d):null,h=d.touchMove?d.touchMove.bind(d):null);this.listen("mousedown",b,g=>{function l(n){const q=n.target;k.moveTarget=q;k.lastPos=k.currentPos;k.currentPos={x:n.offsetX,y:n.offsetY};k.lastMovement={dx:k.currentPos.x-k.lastPos.x,dy:k.currentPos.y-k.lastPos.y};k.totalMovement={dx:k.currentPos.x-k.startPos.x,dy:k.startPos.y-k.lastPos.y};m.logger.debug("mousemove "+q.id);h(k,n);return!0}function p(n){const q=n.target;k.moveTarget=
q;m.logger.debug("mouseup "+q.id);document.removeEventListener("mouseup",p);document.removeEventListener("mousemove",l);f(k,n);return!0}var m=this;const k={startPos:{x:g.offsetX,y:g.offsetY},currentPos:{x:g.offsetX,y:g.offsetY},lastPos:{x:g.offsetX,y:g.offsetY},totalMovement:{dx:0,dy:0},lastMovement:{dx:0,dy:0},container:b,moveTarget:g.target},r=g.target;if(r==b||this.match(r,c))return this.logger.debug("mousedown "+r.id),e&&e(k,g),document.addEventListener("mousemove",l),document.addEventListener("mouseup",
p),!0;this.logger.debug("mousedown not matched "+r.id);return!1})}touchHandlers(a,b,c,d,e){var f=!1;a=this.first(a);this.logger.debug("touch handlers "+b+"  "+f);c&&this.listen("mousedown",a,h=>{f=!0;this.logger.debug("set touching "+b);const g=h.target;return this.match(g,b)?(c(g,h),!0):!1});e&&this.listen("mouseup",document.body,h=>{const g=h.target;this.logger.debug("mouseup "+(f?"is":"is not")+" touching ");if(f)return f=!1,e(g,h),!0;this.logger.debug("set not touching ");return!1});d&&this.listen("mousemove",
a,h=>{this.logger.debug("mousemove "+(f?"is":"is not")+" touching ");const g=h.target;return f&&this.match(g,b)?(d(g,h),!0):!1})}match(a,b){return a==b||null==b?!0:a&&a.matches(b)}onChange(a,b){this.listen("change",a,c=>{const d=c.target;if(this.match(d,a)){var e=d.value;if("number"==d.type||"range"==d.type)e*=1;return b(d,c,e)}})}onInput(a,b){this.listen("input",a,c=>{const d=c.target;if(this.match(d,a)){var e=d.value;if("number"==d.type||"range"==d.type)e*=1;return b(d,c,e)}})}onClick(a,b){this.listen("click",
a,c=>{const d=c.target;if(this.match(d,a))return b(d,c)})}listen(a,b,c){this.find(b).forEach(d=>{var e={type:a,element:d,handler:f=>{var h=c(f);if("undefined"==typeof h||h)f.stopPropagation(),f.preventDefault()}};d.addEventListener(a,e.handler);this.listeners.push(e)})}getPixel(a,b,c){a=this.first(a);null==this.canvas&&(this.canvas=document.createElement("canvas"));this.canvas.width=a.naturalWidth;this.canvas.height=a.naturalHeight;this.canvas.getContext("2d").drawImage(a,0,0,a.naturalWidth,a.naturalHeight);
return this.canvas.getContext("2d").getImageData(b,c,1,1).data}getValue(a){a=this.first(a);if("range"==a.type||"number"==a.type)return Number.parseFloat(a.value);if("SELECT"==a.tagName){const c=this.find(a,"option");for(var b=0;b<c.length;b++)if(c[b].selected)return c[b].value}return a.value}setValue(a,b){this.find(a).forEach(c=>{if("SELECT"==c.tagName){var d=null;this.find(c,"option").forEach(e=>{e.value==b?(d=e,e.selected=!0):e.selected=!1});null==d&&this.addOption(c,b,!0)}else c.value=b})}setHtml(a,
b){this.find(a).forEach(c=>{c.innerHTML=b})}addOption(a,b,c=!1){this.find(a).forEach(d=>{d=document.createElement("option");d.value=b;d.innerHTML=b;c&&d.setAttribute("selected","selected");a.appendChild(d)})}setSelectOptions(a,b,c,d="--select--"){DOM$$module$.find(a).forEach(e=>{e.innerHTML="";d&&this.addOption(e,d);b.forEach(f=>{this.addOption(e,f,f==c)})})}isChecked(a){return(a=this.first(a))&&a.checked}}const DOM$$module$=new Dom$$module$,colorMgr$$module$=new ColorManager$$module$;
var $jscompDefaultExport$$module$=LedApp$$module$,module$={};module$.LedApp=LedApp$$module$;module$.default=$jscompDefaultExport$$module$;